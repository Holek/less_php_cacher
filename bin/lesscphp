#!/usr/bin/env ruby
 
require File.expand_path(File.join(File.dirname(__FILE__), '..', 'lib', 'less_css_php'))

arg = (ARGV[0] ||= 'help').gsub(/\A\--*/, '')

if arg && File.exist?(arg)
  if Less::PHP.ready?
    Less::PHP.cache(arg.gsub(/(\.less|_less)\Z/i, ''))
  else
    puts "Please run 'lesscphp prepare' to initialize this project"
  end
else  
  case arg
  when 'prepare'
    unless Less::PHP.ready?
      Less::PHP.prepare
      puts "LESS PHP parser and cache folder created"
    else
      puts "LESS is already prepared and ready for use"
    end
  when 'remove'
    if Less::PHP.ready?
      Less::PHP.remove
      puts "LESS has been removed from this project, although the cache folder should be removed manually"
    else
      puts "Can't find LESS to remove it"
    end
  when 'update'
    if Less::PHP.ready?
      Less::PHP.update
      puts "LESS has been updated to the latest version"
    else
      puts "Can't find LESS to update it"
    end
  else
    puts "/**"
    puts " * LESS CSS PHP cacher"
    puts " * Extension to LESS CSS for creating cache files your PHP projects can use"
    puts " * Copyright (c) 2009 Aaron Russell [http://www.aaronrussell.co.uk]"
    puts " * Licensed under the MIT license [http://www.opensource.org/licenses/mit-license.php]"
    puts " * Less is maintained by Alexis Sellier [http://github.com/cloudhead/less]"
    puts " **/\n\n"
    puts "Usage: lesscphp [command]\n\n"
    puts "Commands:\n\n"
    puts "\tprepare\tInstalls the PHP wrapper for LESS and creates a cache folder in your web root\n"
    puts "\tremove\tRemoves the PHP wrapper from your web project\n"
    puts "\tupdate\tUpdates the PHP wrapper to the latest version\n"
    puts "\thelp\tDisplays this help dialogue\n\n"
    puts "Implementation:"
    puts "\t<link rel=\"stylesheet\" href=\"less.php?stylesheet.less\" type=\"text/css\">"
    puts "\t..or.."
    puts "\t<?php include 'less.php'; ?>"
    puts "\t<style type=\"text/css\">"
    puts "\t\t<?php less_php('stylesheet.less'); ?>"
    puts "\t</style>\t\t"
    puts "==="
  end
end